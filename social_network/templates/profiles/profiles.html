
{% extends 'base.html' %}
{% load static %}

{% block Profiles %}
<div class="w-64 mr-4 flex-shrink-0">

    <!-- Центральная часть -->

    <div class="bg-white rounded border p-3 mb-4 dark:bg-zinc-800 dark:border-zinc-700">
        <!-- Аватарка -->
        <div class="relative group cursor-pointer">
            
            <img class="rounded-sm" src="{% if user.avatar %}{{user.avatar.url}}{%else%}{% static '/img/avatar7.png' %}{%endif%}" alt="Name">
            
            <!-- <div class="absolute top-0 right-0 opacity-0 group-hover:opacity-100">
                <button class="flex justify-center items-center w-4 h-4 bg-black bg-opacity-50 text-white text-opacity-75 hover:text-opacity-100 rounded-tr-sm rounded-bl-sm focus:outline-none">
                    <svg class="w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                      
                </button>
            </div> 
            <div class="absolute bottom-0 right-0 left-0 opacity-0 group-hover:opacity-100">
                <ul class="bg-black bg-opacity-50 rounded-b-sm">
                    <li>
                        <a href="#" class=" flex items-center px-3 py-1  text-white text-opacity-75 hover:text-gray-100">
                            <div class="mr-2">
                                <svg class="w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                                </svg>
                                  
                            </div>
                            Обновить фотографию</a>
                    </li>
                </ul>
            </div>  -->
        
        </div>
        <!-- Все что ниже аватара в блоке -->
        <div class="flex pt-3">
            {%if request.user == user %}
            <a href="{% url 'settingprofile' user.id %}" class="bg-gray-200 rounded w-full text-center px-3 py-1 text-gray-600 hover:text-opacity-75 dark:bg-gray-200">
                Редактировать профиль
            </a>
            {%endif%}
                               
                                
        </div>
        <!-- <ul class="pt-3 -mx-3">
            <li>
                <a href="" class="flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 group dark:hover:bg-zinc-700 dark:text-gray-400">
                    <div class="mr-2">
                        <svg class="w-4 text-grey-400 group-hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5m.75-9l3-3 2.148 2.148A12.061 12.061 0 0116.5 7.605" />
                          </svg>
                          
                    </div>
                    Статистика страницы
                    
                </a>
            </li>
            <li>
                <a href="" class="flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 group dark:hover:bg-zinc-700 dark:text-gray-400">
                    <div class="mr-2">
                        <svg class="w-4 text-grey-400 group-hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          
                          
                    </div>
                    Воспоминание
                    
                </a>
            </li>
            <li>
                <a href="" class="flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 group dark:hover:bg-zinc-700 dark:text-gray-400">
                    <div class="mr-2">
                        <svg class="w-4 text-grey-400 group-hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                        </svg>
                          
                    </div>
                    Архив историй
                    
                </a>
            </li>
            <li>
                <a href="" class="flex items-center px-3 py-1 text-gray-600 hover:bg-gray-100 group dark:hover:bg-zinc-700 dark:text-gray-400">
                    <div class="mr-2">
                        <svg class="w-4 text-grey-400 group-hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                        </svg>
                          
                    </div>
                    Денежные переводы
                    
                </a>
            </li>
        </ul> -->
    </div>
    <div class="w-64 mr-4 flex-shrink-0">
        
        <div class="bg-white rounded border mb-4 dark:bg-zinc-800 dark:border-zinc-700 dark:text-white">
            <div class="flex">
                <a href="{% url 'show_users' %}" class="flex-1 pl-3 pt-2 font-semibold">Коллеги онлайн
                    <span class="text-gray-500 dark:text-gray-400">{{sh_online.count}}</span>

                </a>

            </div>
            <div class="grid grid-cols-3 gap-3 p-3">
                {% for p in sh_online %}
                {% if forloop.counter <= 6 %}
                <div>
                    <div class="px-1 mb-1">
                        <a href="{% url 'addpost' p.username%}"><img class="rounded-full h-14 w-14" src="{%if p.avatar%}{{p.avatar.url}}{%else%}{% static '/img/avatar7.png' %}{%endif%}" alt="Name"></a>
                        
                        
                    </div>

                    <div class="text-center truncate -mx-1">
                        <a href="{% url 'addpost' p.username%}" class="text-blue-500 hover:underline dark:text-blue-400">{{p.first_name}}</a>
                    </div>
                </div>
                {% endif %}
                {%endfor%}
                
                
            </div>

       
        </div>
        <div class="bg-white rounded border mb-4  dark:bg-zinc-800 dark:border-zinc-700 dark:text-white">
            <div class="flex">
                <a href="{% url 'show_users' %}" class="flex-1 pl-3 pt-2 font-semibold">Коллеги
                    <span class="text-gray-500 dark:text-gray-400">{{user_list.all.count}}</span>

                </a>

            </div>
            <div class="grid grid-cols-3 gap-3 p-4">
                
                {% for p in user_list %}
                {% if forloop.counter <= 6 %}
                
                <div>
                    <div class="px-1 mb-1">
                        <a href="{% url 'addpost' p.username%}"><img class="rounded-full h-14 w-14" src="{%if p.avatar%}{{p.avatar.url}}{%else%}{% static '/img/avatar7.png' %}{%endif%}" alt="Name"></a>

                    </div>

                    <div class="text-center truncate -mx-1">
                        <a href="{% url 'addpost' p.username%}" class="text-blue-500 hover:underline dark:text-blue-400">{{p.first_name}}</a>
                    </div>
                </div>
                {% endif %}
                {%endfor%}

            </div>

       
        </div>
        
    

    </div>
    
</div>
<div class="flex-1">
    
    <!-- Профиль -->

    <div x-data="{open: false}" class="bg-white rounded border mb-4 dark:bg-zinc-800 dark:border-zinc-700 dark:text-white">
        <div class="px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="text-xl">
                    {{user.first_name}} {{user.last_name }}
                </div>
                
                <div class="text-gray-500 dark:text-gray-400">{% if user.online %}online{%else%}Offline{%endif%}</div>  
            </div>

            <div>
                Статут пользователя (в разработке)
            </div>

        </div>
        <div class="p-4 space-y-2">
            <div class="h-px bg-gray-200 dark:bg-zinc-700"></div>

        </div>
        <div class="px-4">
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                     День рождения:
                </div>
                <div class="col-span-2">
                    <span class="text-blue-500 hover:underline dark:text-blue-400">{{user.birthday}}</span>
                    
                </div>
            </div>
        </div>
        <div class="px-4">
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                     Подразделение:
                </div>
                <div class="col-span-2">
                    <span class="text-blue-500 hover:underline dark:text-blue-400">{{user.cat}}</span>
                    
                </div>
            </div>
        </div>
        <div class="px-4">
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Звание
                </div>
                <div class="col-span-2 ">
                    {{user.rank}}
                </div>
            </div>
        </div>
        <div class="px-4">
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Должность
                </div>
                <div class="col-span-2">
                    {{user.position}}
                </div>
                
            </div>
        </div>
        <button x-on:click="open = ! open" class="grid grid-cols-3 gap-2 w-full py-2 text-left text-blue-500 hover:bg-gray-200 focus:outline-none dark:hover:bg-zinc-700 dark:text-blue-400">
            <div></div>
            <div class="col-span-2">
                <div x-show="open === false">Показать подробную информацию</div>
                <div x-cloak x-show="open === true" >Скрыть подробную информацию</div>
            </div>
        </button>

        <div x-cloak x-show="open" class="group px-4 pb-2" >
            <div class=" relative flex items-center mb-2">
                <div class="pr-2 font-semibold">Контактная информация</div>
                <div class="flex-1">
                    <div class="h-px bg-gray-200 dark:bg-zinc-700"></div>
                </div>
                <!-- <div class="absolute top-0 right-0 bg-white pl-2 opacity-0 group-hover:opacity-100 trasition dark:bg-zinc-800">
                    <a href="#" class="text-gray-400 hover:underline ">Редактировать</a>
                </div> -->
            </div>
          
            <div class="grid grid-cols-3 gap-2 pb-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Номер кабинета
                </div>
                <div class="col-span-2 ">
                    {{user.cab}}
                </div>
                
            </div>
            {%if user.phone_city%}
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Телефон город:
                </div>
                <div class="col-span-2">
                    {{user.phone_city}}
                </div>
            </div>
            {%endif%}
            {%if user.phone_hc%}
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Телефон HiCom:
                </div>
                <div class="col-span-2">
                    {{user.phone_hc}}
                </div>
            </div>
            {%endif%}
            {%if user.phone_pts%}
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Телефон ПТС:
                </div>
                <div class="col-span-2">
                    {{user.phone_pts}}
                </div>
            </div>
            {%endif%}
            {%if user.phone_9%}
            <div class="grid grid-cols-3 gap-2">
                <div class="text-gray-500 dark:text-gray-400">
                    Телефон ФЕС-9
                </div>
                <div class="col-span-2">
                    {{user.phone_9}}
                </div>
            </div>
            {%endif%}
        </div>
    </div>
    <!-- Фото -->
    <!-- <div class="bg-white rounded border mb-4 dark:bg-zinc-800 dark:border-zinc-700 dark:text-white">
        <div class="flex justify-between items-center">
            <a href="#" class="flex-1 pl-4 pt-2 pb-1 font-semibold">
                Мои фотографии <span class="text-gray-500 dark:text-gray-400">123</span></a>
            <a href="#" class="pr-4 pt-3 pb-1 text-gray-500 hover:underline dark:text-gray-400">Показать на карте</a>
    
        </div>
        <div class="px-4 pt-3 pb-4">
            <div class="grid grid-cols-4 gap-2">
                <div class="relative group pt-full cursor-pointer">
                    <div class="absolute inset-0">
                        <img class="w-full h-full object-center object-cover" src="image/work-1.jpg" alt=""></div>
                    <div class="absolute top-0 right-0 opacity-0 group-hover:opacity-100">
                        <button class="flex justify-center items-center w-4 h-4 bg-black bg-opacity-50 text-white text-opacity-75 hover:text-opacity-100 rounded-tr-sm rounded-bl-sm focus:outline-none">
                            <svg class="w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                              
                        </button>
                    </div>
                </div>
                <div class="relative group pt-full cursor-pointer">
                    <div class="absolute inset-0">
                        <img class="w-full h-full object-center object-cover" src="image/work-2.jpg" alt=""></div>
                    <div class="absolute top-0 right-0 opacity-0 group-hover:opacity-100">
                        <button class="flex justify-center items-center w-4 h-4 bg-black bg-opacity-50 text-white text-opacity-75 hover:text-opacity-100 rounded-tr-sm rounded-bl-sm focus:outline-none">
                            <svg class="w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                              
                        </button>
                    </div>
                </div>
                <div class="relative group pt-full cursor-pointer">
                    <div class="absolute inset-0">
                        <img class="w-full h-full object-center object-cover" src="image/work-3.jpg" alt=""></div>
                    <div class="absolute top-0 right-0 opacity-0 group-hover:opacity-100">
                        <button class="flex justify-center items-center w-4 h-4 bg-black bg-opacity-50 text-white text-opacity-75 hover:text-opacity-100 rounded-tr-sm rounded-bl-sm focus:outline-none">
                            <svg class="w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                              
                        </button>
                    </div>
                </div>
                <div class="relative group pt-full cursor-pointer">
                    <div class="absolute inset-0">
                        <img class="w-full h-full object-center object-cover" src="image/work-4.jpg" alt=""></div>
                    <div class="absolute top-0 right-0 opacity-0 group-hover:opacity-100">
                        <button class="flex justify-center items-center w-4 h-4 bg-black bg-opacity-50 text-white text-opacity-75 hover:text-opacity-100 rounded-tr-sm rounded-bl-sm focus:outline-none">
                            <svg class="w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                              
                        </button>
                    </div>
                </div>

            </div>
        </div>
        
    </div> -->
    <!-- Form -->
    {%if request.user == user %}
    <div>
        <form x-data="activateImagePreview()" action="" method="post" id="comment-form" enctype="multipart/form-data" class="bg-white  mb-4">
            {% csrf_token %}
            <div x-data="{open:false}" class="pl-4 pr-4 py-1 rounded border">
                <div x-on:click="open = true" class="flex flex-shrink-0 items-start">
                    <div class="py-1 flex-shrink-0 mr-4">
                        <img class="w-11 h-11 flex-shrink-0 rounded-full" src="{%if user.avatar%}{{user.avatar.url}}{%else%}{% static '/img/avatar7.png' %}{%endif%}" alt="">
                    </div>
                    <div class="w-full">
                        <textarea  rows="1" id="id_content" name="content"  required="" class=" text-base pl-3 w-full hidden border-none rounded resize-none py-1 focus:outline-none" placeholder="Что у вас нового?"></textarea>
                    </div>
                    
                </div>
                <div x-ref="previewSingle" class="flex justify-center flex-wrap"></div>
                
                
                
                <div x-cloak x-show="open"  class="border-b h-px  mb-4 mt-2"></div>
                
                
                <div class="mb-2 hidden">
                      
                    <input class="input__file-button block w-full h-10.5 leading-9 rounded overflow-hidden text-sm text-gray-900 bg-gray-50 border border-gray-300 cursor-pointer dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400" id="id_photo" name="photo" multiple @change="showPreview(event, $refs.previewSingle)" type="file">
                </div>
                
                <div x-cloak x-show="open"  class="flex justify-end items-center my-2">
                    
                    <div class="mr-4">
                        <label for="id_photo" class="input__file-button cursor-pointer  ">
                            <a for="id_photo">
                                <svg  class="w-7 text-gray-500 hover:text-gray-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                               <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                             </svg>
                             </a>
                        </label>
                    </div>
                    
                     
                    <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4  focus:ring-blue-300 font-medium rounded text-base px-5 py-2.5 me-2  dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Опубликовать</button>        
                    
                </div>
            </div>
        </form>
     
    </div>
    {%endif%}

    <script>
        let inputs = document.querySelectorAll('#id_photo');
        Array.prototype.forEach.call(inputs, function (input) {
          let label = input.nextElementSibling,
            labelVal = label.querySelector('.input__file-button-text').innerText;
      
          input.addEventListener('change', function (e) {
            let countFiles = '';
            if (this.files && this.files.length >= 1)
              countFiles = this.files.length;
      
            if (countFiles)
              label.querySelector('.input__file-button-text').innerText = 'Выбрано файлов: ' + countFiles;
            else
              label.querySelector('.input__file-button-text').innerText = labelVal;
          });
        });
        
        function activateImagePreview() {
            return {
                showPreview(event, previewBox) {
                    previewBox.replaceChildren();

                    for (const i in event.target.files) {
                        let img = document.createElement('img');
                        img.className = 'aspect-auto my-2 mx-1 h-24 rounded shadow';
                        img.src = URL.createObjectURL(event.target.files[i]);
                        previewBox.appendChild(img);
                        

                    } 
                }
            }
        }
    </script>

{% endblock Profiles %}

{%block content%}

{% include "includes/post.html" %}

{%endblock content%}

{% block test %}

<!-- Профиль -->


<!-- Форма добавления поста-->

{% if user.is_authenticated %}                    
{%if request.user == user %}
<article class="post">
    
        <section>
            <form action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
        
            <div class="row gtr-uniform">
                <div class="col-6 col-12-xsmall">
                 
                    {{form.title}}

                </div>
                <div class="col-6 col-12-xsmall">
                    {{form.cat}}

                </div>


                <div class="col-12">
                    {{form.content}}
                </div>

            </div>
        
        </section>


<footer>
    <ul class="actions">

        <button type="submit">Добавить</button> 
    </ul>
    <ul class="stats">
        

        <li>
            
            {{form.photo}}

               <label for="id_photo" class="input__file-button">
            <a for="id_photo" class="icon solid fa-camera" ></a>
             <span class="input__file-button-text"></span>
             
               </label>

        </li>
        <li>
            <label for="id_photo" class="input__file-button">

            <a href="#" class="icon solid fa-file-word"></a></li></label>
    </ul>
</footer>
</form>
</article>
{%endif%}
{%endif%}

<!-- Посты созданные этим пользователем -->
{% for p in posts %}

<article class="post">

    <header>
        <div class="title">
           
            <h2><a href="{{p.get_absolute_url}}">{{p.title}}</a></h2>
            <p>{{p.cat}}</p>
        </div>
        <div class="meta">
            <time class="published" datetime="{{p.time_create}}">{{p.time_update|time:"G:i"}}<br>{{p.time_update|date:"d F Y"}}</time>
            {%if p.author.avatar%}
            <a href="{{p.author.get_absolute_url}}" class="author"><span class="name">{{p.author.last_name}}<br>{{p.author.first_name}}<br>{{p.author.patronymic}}</span><img
                    src="{{p.author.avatar.url}}" alt="" /></a>
                    {%else%}
                    <a href="{{p.author.get_absolute_url}}" class="author"><span class="name">{{p.author.last_name}}<br>{{p.author.first_name}}<br>{{p.author.patronymic}}</span><img
                        src="{% static 'post/images/avatar7.png' %}" alt="" /></a>
                    {% endif %}
                    
        </div>
    </header>
    
    {% if p.photo %}
    <a href="{{p.get_absolute_url}}" class="image featured">    <img src="{{p.photo.url}}" alt="" /></a>
    {% endif %}
    <p>{{p.content|linebreaks|truncatewords:40}}</p> <!--linebreak добавляется перенос строки и абзацы в тексте; truncatewords:40 отображение только 40 слов статьи-->
    <footer>
        <ul class="actions">
            <li><a href="{{p.get_absolute_url}}" class="button large">Подробнее</a></li>
        </ul>
        <ul class="stats">
            <li><a href="#" class="icon solid fa-comment">128</a></li>
            <li><a href="#" class="icon solid fa-heart">28</a></li>

        </ul>

    </footer>

</article>
{% endfor %}

{% endblock test %}

